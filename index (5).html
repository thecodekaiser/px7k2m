<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will you be my Valentine? üíï</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; }
        body {
            font-family: 'Quicksand', sans-serif;
            background: #f4b8cc;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .hearts-bg {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 0; overflow: hidden;
        }
        .floating-heart {
            position: absolute; opacity: 0;
            animation: floatUp linear infinite;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg) scale(0.5); opacity: 0; }
            10% { opacity: 0.1; }
            90% { opacity: 0.1; }
            100% { transform: translateY(-10vh) rotate(360deg) scale(1.2); opacity: 0; }
        }

        .card {
            background: rgba(255,255,255,0.96);
            border-radius: 28px;
            padding: 48px 48px 36px;
            text-align: center;
            position: relative;
            z-index: 10;
            box-shadow: 0 8px 50px rgba(0,0,0,0.06);
            width: 640px;
            min-height: 500px;
            animation: cardEntry 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards;
            transform: scale(0.85) translateY(25px);
            opacity: 0;
            /* No button must stay inside */
            overflow: hidden;
        }
        @keyframes cardEntry { to { transform: scale(1) translateY(0); opacity: 1; } }

        .character {
            width: 100px; height: 95px;
            margin: 0 auto 22px;
            position: relative;
            animation: bounce 3s ease-in-out infinite;
        }
        @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-7px); } }

        .face {
            width: 88px; height: 82px;
            background: linear-gradient(145deg,#ffcc80,#ffb74d);
            border-radius: 50% 50% 48% 48%;
            margin: 0 auto; position: relative;
            box-shadow: 0 4px 12px rgba(255,167,38,0.25);
        }
        .face::before, .face::after {
            content:''; position: absolute;
            width: 26px; height: 20px;
            background: linear-gradient(145deg,#ffcc80,#ffb74d);
            top: -7px; border-radius: 50% 50% 10% 10%;
        }
        .face::before { left: 8px; transform: rotate(-15deg); }
        .face::after { right: 8px; transform: rotate(15deg); }

        .eyes { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 18px; }
        .eye { width: 9px; height: 9px; background: #4a3728; border-radius: 50%; position: relative; animation: blink 4s ease-in-out infinite; }
        .eye::after { content:''; position: absolute; width: 3px; height: 3px; background: white; border-radius: 50%; top: 1px; right: 1px; }
        @keyframes blink { 0%,45%,55%,100% { transform: scaleY(1); } 50% { transform: scaleY(0.1); } }

        .nose { position: absolute; top: 44px; left: 50%; transform: translateX(-50%); width: 7px; height: 5px; background: #e8967a; border-radius: 50%; }
        .blush { position: absolute; width: 14px; height: 9px; background: rgba(255,130,130,0.3); border-radius: 50%; top: 42px; }
        .blush.l { left: 10px; } .blush.r { right: 10px; }
        .heart-acc { position: absolute; top: -10px; right: -3px; font-size: 1.3rem; animation: hpulse 1.5s ease-in-out infinite; }
        @keyframes hpulse { 0%,100% { transform: scale(1) rotate(15deg); } 50% { transform: scale(1.15) rotate(15deg); } }

        .question {
            font-size: 1.6rem; font-weight: 800;
            color: #2d2d2d; margin-bottom: 30px; line-height: 1.4;
        }

        .buttons-row {
            display: flex; align-items: center; justify-content: center;
            gap: 70px; margin-bottom: 14px;
        }

        .btn-yes {
            font-family: 'Quicksand',sans-serif; font-weight: 700;
            border: none; padding: 15px 44px; font-size: 1.1rem;
            border-radius: 50px; cursor: pointer;
            background: linear-gradient(135deg,#ff6b8a,#e84393);
            color: white; box-shadow: 0 4px 18px rgba(232,67,147,0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative; z-index: 5;
        }
        .btn-yes:hover { transform: scale(1.06); box-shadow: 0 6px 28px rgba(232,67,147,0.45); }
        .btn-yes { transition: transform 0.4s ease, box-shadow 0.4s ease; }

        /* Static No ‚Äî matches original reel style */
        .btn-no-static {
            font-family: 'Quicksand',sans-serif; font-weight: 600;
            border: 1.5px solid #ddd; padding: 14px 40px; font-size: 1.05rem;
            border-radius: 50px; cursor: pointer;
            background: white; color: #777;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        /* Floating No ‚Äî absolutely positioned INSIDE card */
        .btn-no-float {
            position: absolute;
            font-family: 'Quicksand',sans-serif; font-weight: 600;
            border: 1.5px solid #ddd; padding: 14px 40px; font-size: 1.05rem;
            border-radius: 50px;
            background: white; color: #777;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            /* CRITICAL: no click, no pointer cursor */
            cursor: default;
            pointer-events: none;
            user-select: none; -webkit-user-select: none;
            touch-action: none;
            z-index: 4;
            will-change: left, top;
        }

        .shy-text {
            font-size: 1.15rem; color: #b08a8a; font-weight: 600;
            opacity: 0; transition: opacity 0.4s ease; min-height: 1.5em;
            margin-top: 16px;
        }
        .shy-text.visible { opacity: 1; }

        .yay-screen { display: none; text-align: center; }
        .yay-screen.active { display: block; animation: yayIn 0.6s cubic-bezier(0.34,1.56,0.64,1) forwards; }
        @keyframes yayIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .yay-name {
            font-size: 1.6rem; font-weight: 800;
            color: #2d2d2d; margin-bottom: 4px; line-height: 1.4;
        }
        .yay-title { font-size: 1.3rem; font-weight: 700; color: #2d2d2d; margin-bottom: 18px; }
        .yay-emoji { font-size: 1.8rem; display: inline-block; animation: pop 0.5s ease-out; }
        @keyframes pop { 0% { transform: scale(0) rotate(-30deg); } 60% { transform: scale(1.3) rotate(10deg); } 100% { transform: scale(1) rotate(0); } }
        .yay-msg { font-size: 0.95rem; color: #999; margin: 0.75rem 0 1.5rem; font-weight: 500; line-height: 1.5; }
        .yay-gif { width: 400px; max-width: 85%; border-radius: 14px; margin: 0 auto; box-shadow: 0 6px 25px rgba(0,0,0,0.08); display: block; }
        .gif-fallback { align-items: center; justify-content: center; margin: 0 auto; }

        #confettiCanvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:100; }
        .sparkle { position:fixed; border-radius:50%; pointer-events:none; z-index:99; animation: sparkOut 0.8s ease-out forwards; }
        @keyframes sparkOut { 0%{transform:scale(1);opacity:1;} 100%{transform:scale(0) translate(var(--tx),var(--ty));opacity:0;} }

        @media (max-width: 600px) {
            .card { width: 93vw; padding: 35px 24px 28px; min-height: 380px; }
            .question { font-size: 1.3rem; margin-bottom: 24px; }
            .btn-yes { padding: 13px 36px; font-size: 1rem; }
            .btn-no-static, .btn-no-float { padding: 12px 32px; font-size: 0.95rem; }
        }
    </style>
</head>
<body>
    <div class="hearts-bg" id="heartsBg"></div>

    <div class="card" id="card">
        <div class="question-screen" id="qScreen">
            <div class="character">
                <div class="face">
                    <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                    <div class="nose"></div>
                    <div class="blush l"></div><div class="blush r"></div>
                </div>
                <div class="heart-acc">üíï</div>
            </div>
            <div class="question">himani, will you be my valentine?</div>
            <div class="buttons-row" id="btnRow">
                <button class="btn-yes" id="btnYes" onclick="sayYes()">Yes</button>
                <button class="btn-no-static" id="btnNoStatic">No</button>
            </div>
            <div class="shy-text" id="shyText"></div>
        </div>

        <div class="yay-screen" id="yayScreen">
            <div class="character">
                <div class="face">
                    <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                    <div class="nose"></div>
                    <div class="blush l"></div><div class="blush r"></div>
                </div>
                <div class="heart-acc">üíï</div>
            </div>
            <div class="yay-name">himani, will you be my valentine?</div>
            <div class="yay-title">YAY! <span class="yay-emoji">üéâ</span></div>
            <img class="yay-gif"
                 src="https://media1.giphy.com/media/lXu72d4iKwqek/giphy.gif"
                 alt=""
                 onerror="this.onerror=null;this.src='https://media.tenor.com/images/6007dc1e0ecea1f498e5e8c94ab1e3a3/tenor.gif';this.onerror=function(){this.style.display='none';document.getElementById('gifFallback').style.display='flex';};" />
            <div id="gifFallback" class="gif-fallback" style="display:none;">
                <span style="font-size:4rem;">ü•≥üéäüéâ</span>
            </div>
        </div>
    </div>
    <canvas id="confettiCanvas"></canvas>

<script>
const card = document.getElementById('card');
const staticBtn = document.getElementById('btnNoStatic');

// Hearts
const hBg = document.getElementById('heartsBg');
const hE = ['üíï','üíó','üíñ','üíì','ü©∑','‚ô•Ô∏è','üå∏'];
for (let i = 0; i < 18; i++) {
    const h = document.createElement('div');
    h.className = 'floating-heart';
    h.textContent = hE[Math.floor(Math.random()*hE.length)];
    h.style.left = Math.random()*100+'%';
    h.style.fontSize = (0.8+Math.random()*1.5)+'rem';
    h.style.animationDuration = (8+Math.random()*12)+'s';
    h.style.animationDelay = (Math.random()*10)+'s';
    hBg.appendChild(h);
}

// ===== STATE =====
let escaped = false;
let floatBtn = null;
let animId = null;
let btnX = 0, btnY = 0;
let velX = 0, velY = 0;
let mouseX = -9999, mouseY = -9999;

// ===== PHYSICS ‚Äî strong, from our best iteration =====
const CURSOR_RADIUS = 160;
const CURSOR_FORCE = 28;
const FRICTION = 0.88;
const MAX_VEL = 22;
const PAD = 10;

let chaseCount = 0, lastMsgIdx = -1, yesLevel = 0;
let lastMsgTime = 0;
const MSG_COOLDOWN = 4000; // milliseconds ‚Äî each message stays at least 4 seconds
const msgs = [
    '"No" seems a bit shy üê±',
    'It\'s running away! üòÇ',
    'You can\'t catch it! üèÉ‚Äç‚ôÇÔ∏è',
    'Slippery little button ü´£',
    'Maybe just click Yes? üòè',
    'It has trust issues üí®',
    'Resistance is futile! üòÇ',
    'Just give in already üíï',
];

function showMsg() {
    const now = Date.now();
    const el = document.getElementById('shyText');
    // First message shows immediately
    if (lastMsgIdx === -1) {
        lastMsgIdx = 0;
        lastMsgTime = now;
        el.classList.add('visible');
        el.textContent = msgs[0];
        return;
    }
    // Only advance if cooldown has passed and there are more messages
    if (lastMsgIdx < msgs.length - 1 && now - lastMsgTime >= MSG_COOLDOWN) {
        lastMsgIdx++;
        lastMsgTime = now;
        el.textContent = msgs[lastMsgIdx];
    }
}

function relMouse(cx, cy) {
    const r = card.getBoundingClientRect();
    return { x: cx - r.left, y: cy - r.top };
}

// ===== MOUSE TRACKING =====
document.addEventListener('mousemove', e => {
    const m = relMouse(e.clientX, e.clientY);
    mouseX = m.x; mouseY = m.y;
    if (!escaped) checkInit();
});
document.addEventListener('touchmove', e => {
    const t = e.touches[0], m = relMouse(t.clientX, t.clientY);
    mouseX = m.x; mouseY = m.y;
}, { passive: true });
document.addEventListener('touchstart', e => {
    const t = e.touches[0], m = relMouse(t.clientX, t.clientY);
    mouseX = m.x; mouseY = m.y;
    if (!escaped) checkInit();
}, { passive: true });

// ===== INIT =====
staticBtn.addEventListener('mouseenter', () => initEscape());
staticBtn.addEventListener('touchstart', e => {
    e.preventDefault();
    const t = e.touches[0], m = relMouse(t.clientX, t.clientY);
    mouseX = m.x; mouseY = m.y;
    initEscape();
}, { passive: false });
staticBtn.addEventListener('click', e => { e.preventDefault(); initEscape(); });

function checkInit() {
    if (escaped) return;
    const r = staticBtn.getBoundingClientRect(), cR = card.getBoundingClientRect();
    const cx = r.left - cR.left + r.width/2, cy = r.top - cR.top + r.height/2;
    if (Math.hypot(mouseX - cx, mouseY - cy) < 65) initEscape();
}

function initEscape() {
    if (escaped) return;
    escaped = true;

    const bR = staticBtn.getBoundingClientRect();
    const cR = card.getBoundingClientRect();

    // Hide static
    staticBtn.style.visibility = 'hidden';
    staticBtn.style.pointerEvents = 'none';

    // Create floating No inside card
    floatBtn = document.createElement('button');
    floatBtn.className = 'btn-no-float';
    floatBtn.textContent = 'No';
    card.appendChild(floatBtn);

    btnX = bR.left - cR.left;
    btnY = bR.top - cR.top;
    velX = 0; velY = 0;

    floatBtn.style.left = btnX + 'px';
    floatBtn.style.top = btnY + 'px';

    chaseCount++; showMsg();
    startPhysics();
}

// ===== PHYSICS LOOP =====
function startPhysics() {
    function tick() {
        if (!floatBtn || !escaped) return;

        const btnW = floatBtn.offsetWidth || 100;
        const btnH = floatBtn.offsetHeight || 48;
        const cW = card.clientWidth;
        const cH = card.clientHeight;

        const btnCX = btnX + btnW / 2;
        const btnCY = btnY + btnH / 2;

        const dx = btnCX - mouseX;
        const dy = btnCY - mouseY;
        const dist = Math.hypot(dx, dy);

        // ---- CURSOR REPULSION with perpendicular wall dodge ----
        if (dist < CURSOR_RADIUS && dist > 0.1) {
            chaseCount++;
            if (chaseCount % 12 === 0) yesLevel++;
            showMsg();

            const norm = dist / CURSOR_RADIUS;
            const f = CURSOR_FORCE * Math.pow(1 - norm, 2.5);

            // Direct repulsion direction
            const dirX = dx / dist;
            const dirY = dy / dist;

            // Perpendicular toward card center
            const centerX = cW / 2, centerY = cH / 2;
            let perpX = -dirY, perpY = dirX;
            if ((centerX - btnCX)*perpX + (centerY - btnCY)*perpY < 0) {
                perpX = -perpX; perpY = -perpY;
            }

            // Wall proximity blending
            const minEdge = Math.min(
                Math.max(0, btnX - PAD),
                Math.max(0, cW - btnX - btnW - PAD),
                Math.max(0, btnY - PAD),
                Math.max(0, cH - btnY - btnH - PAD)
            );
            const wallMix = Math.pow(Math.max(0, 1 - minEdge / 80), 2);

            const fx = (dirX * (1 - wallMix * 0.6) + perpX * wallMix * 1.4) * f;
            const fy = (dirY * (1 - wallMix * 0.6) + perpY * wallMix * 1.4) * f;

            velX += fx;
            velY += fy;
        }

        // ---- Gentle center pull when cursor is far ----
        if (dist > CURSOR_RADIUS) {
            const toCX = cW/2 - btnCX, toCY = cH/2 - btnCY;
            const toCD = Math.hypot(toCX, toCY);
            if (toCD > 30) {
                velX += (toCX / toCD) * 0.2;
                velY += (toCY / toCD) * 0.2;
            }
        }

        // ---- Wall bounce with inward kick ----
        if (btnX <= PAD) { btnX = PAD; if (velX < 0) velX = -velX * 0.4 + 2; }
        if (btnX >= cW - btnW - PAD) { btnX = cW - btnW - PAD; if (velX > 0) velX = -velX * 0.4 - 2; }
        if (btnY <= PAD) { btnY = PAD; if (velY < 0) velY = -velY * 0.4 + 2; }
        if (btnY >= cH - btnH - PAD) { btnY = cH - btnH - PAD; if (velY > 0) velY = -velY * 0.4 - 2; }

        // Friction
        velX *= FRICTION;
        velY *= FRICTION;

        // Speed cap
        const spd = Math.hypot(velX, velY);
        if (spd > MAX_VEL) { velX = (velX/spd)*MAX_VEL; velY = (velY/spd)*MAX_VEL; }

        // Update
        btnX += velX;
        btnY += velY;

        // Final clamp
        btnX = Math.max(PAD, Math.min(cW - btnW - PAD, btnX));
        btnY = Math.max(PAD, Math.min(cH - btnH - PAD, btnY));

        floatBtn.style.left = btnX + 'px';
        floatBtn.style.top = btnY + 'px';

        // Yes button grows noticeably as you chase No
        const yesGrowth = Math.min(1.5, 1 + yesLevel * 0.04);
        const yesBtn = document.getElementById('btnYes');
        yesBtn.style.transform = `scale(${yesGrowth})`;
        yesBtn.style.boxShadow = `0 ${4 + yesLevel * 0.8}px ${18 + yesLevel * 3}px rgba(232,67,147,${Math.min(0.55, 0.3 + yesLevel * 0.02)})`;

        animId = requestAnimationFrame(tick);
    }
    tick();
}

// ===== YES =====
function sayYes() {
    escaped = false;
    if (animId) { cancelAnimationFrame(animId); animId = null; }
    if (floatBtn) { floatBtn.remove(); floatBtn = null; }

    document.getElementById('qScreen').style.display = 'none';
    document.getElementById('yayScreen').classList.add('active');
    createSparkles(); launchConfetti();
    document.body.style.background = 'linear-gradient(135deg,#f4b8cc,#fbb,#f4b8cc)';
}

function createSparkles() {
    const colors = ['#ff6b8a','#e84393','#ff9ff3','#ffd700','#ff6348'];
    const btn = document.getElementById('btnYes');
    const r = btn.getBoundingClientRect();
    const cx = r.left+r.width/2, cy = r.top+r.height/2;
    for (let i = 0; i < 15; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.background = colors[Math.floor(Math.random()*colors.length)];
        s.style.left = cx+'px'; s.style.top = cy+'px';
        s.style.setProperty('--tx',(Math.random()-0.5)*200+'px');
        s.style.setProperty('--ty',(Math.random()-0.5)*200+'px');
        const sz = (4+Math.random()*8)+'px'; s.style.width=sz; s.style.height=sz;
        document.body.appendChild(s); setTimeout(()=>s.remove(),800);
    }
}

function launchConfetti() {
    const cv = document.getElementById('confettiCanvas');
    const ctx = cv.getContext('2d');
    cv.width = window.innerWidth; cv.height = window.innerHeight;
    const pcs = [], cols = ['#ff6b8a','#e84393','#ff9ff3','#ffd700','#ff6348','#ff4757','#ff9f43','#f368e0'];
    for (let i = 0; i < 150; i++) {
        pcs.push({ x:Math.random()*cv.width, y:-Math.random()*cv.height,
            w:4+Math.random()*8, h:6+Math.random()*10,
            c:cols[Math.floor(Math.random()*cols.length)],
            ci:Math.random()>0.5, rot:Math.random()*360, rs:(Math.random()-0.5)*8,
            sx:(Math.random()-0.5)*4, sy:2+Math.random()*4,
            op:0.8+Math.random()*0.2, ws:0.03+Math.random()*0.05 });
    }
    let f=0;
    function anim() {
        ctx.clearRect(0,0,cv.width,cv.height); f++;
        let alive=false;
        pcs.forEach(p => {
            if(p.y>cv.height+20)return; alive=true;
            p.y+=p.sy; p.x+=p.sx+Math.sin(f*p.ws)*0.5;
            p.rot+=p.rs; p.op-=0.001;
            ctx.save(); ctx.translate(p.x,p.y);
            ctx.rotate(p.rot*Math.PI/180);
            ctx.globalAlpha=Math.max(0,p.op);
            ctx.fillStyle=p.c;
            if(!p.ci)ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
            else{ctx.beginPath();ctx.arc(0,0,p.w/2,0,Math.PI*2);ctx.fill();}
            ctx.restore();
        });
        if(alive)requestAnimationFrame(anim);
        else ctx.clearRect(0,0,cv.width,cv.height);
    }
    anim();
}
window.addEventListener('resize',()=>{ const c=document.getElementById('confettiCanvas'); c.width=window.innerWidth; c.height=window.innerHeight; });
</script>
</body>
</html>
